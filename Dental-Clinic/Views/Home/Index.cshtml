@using Dental_Clinic.ViewModels
@model DashboardViewModel
@{
    ViewData["Title"] = "Dashboard";
}

<h3 class="mb-4">📊 Dashboard</h3>

<div class="row g-3 mb-4">
    <div class="col-md-3">
        <div class="card shadow-sm border-0 bg-success text-white">
            <div class="card-body">
                <h6>Today's Revenue</h6>
                <h3>Rs. @Model.TodayRevenue</h3>
            </div>
        </div>
    </div>

    <div class="col-md-3">
        <div class="card shadow-sm border-0 bg-primary text-white">
            <div class="card-body">
                <h6>This Month</h6>
                <h3>Rs. @Model.MonthRevenue</h3>
            </div>
        </div>
    </div>

    <div class="col-md-3">
        <div class="card shadow-sm border-0 bg-dark text-white">
            <div class="card-body">
                <h6>This Year</h6>
                <h3>Rs. @Model.YearRevenue</h3>
            </div>
        </div>
    </div>

    <div class="col-md-3">
        <div class="card shadow-sm border-0 bg-warning text-dark">
            <div class="card-body">
                <h6>Today's Appointments</h6>
                <h3>@Model.TodayAppointments</h3>
            </div>
        </div>
    </div>
</div>

<div class="row mb-4">
    <div class="col-md-4">
        <div class="card shadow-sm">
            <div class="card-body text-center">
                <h6>Pending Invoices</h6>
                <h2 class="text-danger">@Model.PendingInvoices</h2>
            </div>
        </div>
    </div>
</div>

<div class="card shadow-sm">
    <div class="card-header bg-light">
        <strong>🧾 Recent Invoices</strong>
    </div>
    <div class="card-body p-0">
        <table class="table table-hover mb-0">
            <thead class="table-light">
                <tr>
                    <th>Invoice #</th>
                    <th>Patient</th>
                    <th>Date</th>
                    <th>Total</th>
                    <th>Paid</th>
                </tr>
            </thead>
            <tbody>
                @foreach (var inv in Model.RecentInvoices)
                {
                    <tr>
                        <td>@inv.InvoiceNo</td>
                        <td>@inv.PatientName</td>
                        <td>@inv.Date.ToString("dd MMM yyyy")</td>
                        <td>Rs. @inv.Total</td>
                        <td>Rs. @inv.Paid</td>
                    </tr>
                }
            </tbody>
        </table>
    </div>
</div>

<div class="card shadow-sm mt-4">
    <div class="card-header bg-light d-flex justify-content-between">
        <strong>📅 Today’s Appointments</strong>
        <span class="badge bg-primary">@Model.TodayAppointmentsList.Count</span>
    </div>

    <div class="card-body p-0">
        <table class="table table-hover mb-0 align-middle">
            <thead class="table-light">
                <tr>
                    <th>Patient</th>
                    <th>Phone</th>
                    <th>Branch</th>
                    <th>Time</th>
                    <th>Status</th>
                    <th width="140">Action</th>
                </tr>
            </thead>
            <tbody>
                @if (!Model.TodayAppointmentsList.Any())
                {
                    <tr>
                        <td colspan="5" class="text-center text-muted py-3">
                            No upcoming appointments today
                        </td>
                    </tr>
                }
                else
                {
                    @foreach (var appt in Model.TodayAppointmentsList)
                    {
                        <tr>
                            <td>@appt.PatientName</td>
                            <td>@appt.Phone</td>
                            <td>@appt.Branch</td>
                            <td>
                                <span class="badge bg-info">
                                    @appt.AppointmentTime
                                </span>
                            </td>
                            <td>
                                <span class="badge 
                                    @(appt.Status == "Completed" ? "bg-success" :
                                      appt.Status == "Cancelled" ? "bg-danger" : "bg-warning")">
                                    @appt.Status
                                </span>
                            </td>
                            <td>
                                <a asp-controller="Appointment"
                                   asp-action="Edit"
                                   asp-route-id="@appt.Id"
                                   class="btn btn-sm btn-outline-primary">
                                    Edit
                                </a>
                            </td>
                        </tr>
                    }
                }
            </tbody>
        </table>
    </div>
</div>
